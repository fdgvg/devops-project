trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Terraform_Deploy
    displayName: 'Terraform Deployment'
    jobs:
      - job: TerraformJob
        steps:
          - checkout: self

          - task: AzureCLI@2
            displayName: 'Terraform Init + Import + Apply'
            inputs:
              azureSubscription: 'AzureSPN'  # your service connection
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                cd infra
                terraform init
                terraform import azurerm_resource_group.rg /subscriptions/4f654df7-d18f-4498-a919-94cc466fcbd6/resourceGroups/devops-rg || true
                terraform apply -auto-approve
