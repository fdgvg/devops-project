trigger:
  - main

variables:
- group: sec variable  # ðŸ‘ˆ Your variable group name

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Terraform_Deploy
    displayName: 'Terraform Deployment'
    jobs:
      - job: TerraformJob
        steps:
          - checkout: self

          - task: AzureCLI@2
            displayName: 'Terraform Init + Import + Apply'
            inputs:
              azureSubscription: 'AzureSPN'
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                echo "âœ… Setting Azure authentication ENV vars..."
                export ARM_SUBSCRIPTION_ID=$(subscription_id)
                export ARM_TENANT_ID=$(tenant_id)
                export ARM_CLIENT_ID=$(client_id)
                export ARM_CLIENT_SECRET=$(client_secret)

                echo "ðŸš€ Starting Terraform"
                cd infra
                terraform init
                terraform import azurerm_resource_group.rg /subscriptions/$(subscription_id)/resourceGroups/devops-rg || true
                terraform apply -auto-approve
