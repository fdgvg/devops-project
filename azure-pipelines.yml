- stage: Terraform_Deploy
  displayName: 'Terraform Infrastructure Deployment'
  jobs:
    - job: TerraformJob
      pool:
        vmImage: 'ubuntu-latest'
      steps:
        - checkout: self

        - task: AzureCLI@2
          displayName: 'Terraform Init, Import RG, and Apply'
          inputs:
            azureSubscription: 'AzureSPN'  # your service connection name
            scriptType: 'bash'
            scriptLocation: 'inlineScript'
            inlineScript: |
              cd infra

              echo "‚öôÔ∏è Initializing Terraform..."
              terraform init

              echo "üì• Importing existing resource group..."
              terraform import azurerm_resource_group.rg /subscriptions/4f654df7-d18f-4498-a919-94cc466fcbd6/resourceGroups/devops-rg || true

              echo "üöÄ Running Terraform Apply..."
              terraform apply -auto-approve
