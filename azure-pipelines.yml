trigger:
  - main

stages:
- stage: Terraform_Deploy
  displayName: 'Terraform Infrastructure Deployment'
  jobs:
    - job: TerraformJob
      displayName: 'Run Terraform to provision App Services'
      pool:
        vmImage: 'ubuntu-latest'
      steps:
        - checkout: self

        - task: AzureCLI@2
          displayName: 'Terraform Init, Plan and Apply'
          inputs:
            azureSubscription: 'AzureSPN'  # <-- Make sure this matches the service connection name
            scriptType: 'bash'
            scriptLocation: 'inlineScript'
            inlineScript: |
              echo "Running Terraform Init, Plan, Apply"
              cd infra
              terraform init
              terraform plan
              terraform apply -auto-approve
